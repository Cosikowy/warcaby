chain attack detection

fixed on game on server

CODE REFACTOR!

unit tests
